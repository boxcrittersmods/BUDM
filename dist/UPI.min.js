const uWindow="undefined"!=typeof unsafeWindow?unsafeWindow:window;let UPI;!function(){"use strict";let t={uWindow:uWindow,UPI:UPI};if(window.UPI){for(let e in t)delete window[e];throw"UPI variables are global! please scope/sandbox it"}class e{constructor(t,e=!!t){if(!Array.isArray(t)&&void 0!==t)throw new TypeError("Paramater 1 must be type 'array'");if(this.strict=!!e,this.events={},this.Event=function(){this.ran=0,this.listeners=[]},t)for(let e of t)this.events[e]=new this.Event}on(t,e){if("function"!=typeof e)throw new TypeError(`Input 2 is type '${typeof e}' instead of 'function'`);if(!this.strict||this.events[t])return this.events[t]||(this.events[t]=new this.Event),this.events[t].listeners.push(e)-1;console.warn(`Event '${t}' does not exist`)}off(t,e){if(this.events[t]){if("function"==typeof e){let o=0;return this.events[t].listeners.forEach(((i,s)=>{i==e&&(o++,delete this.events[t].listeners[s])})),o}if("number"==typeof e){let o=this.events[t].listeners[e];return delete this.events[t].listeners[e],o}if(void 0===e)return this.events[t].listeners.splice(0,1/0);throw new TypeError(`Input 2 is type '${typeof a}' instead of 'function' or 'number'`)}this.strict&&console.warn(`Event '${t}' does not exist`)}emit(t,...e){return this.emitCall(t,this,...e)}emitCall(t,e,...o){if(!this.events[t]){if(this.strict)return console.warn(`Event '${t}' does not exist`),[];this.events[t]=new this.Event}let i=[];this.events[t].ran++;for(let s in this.events[t].listeners)try{i.push(this.events[t].listeners[s].apply(e,o))}catch(t){console.error(t),i.push(t)}return i}}let o=e.prototype;o.addEventListener=o.add=o.when=o.on,o.removeEventListener=o.remove=o.abort=o.off,o.dispatchEvent=o.dispatch=o.send=o.trigger=o.emit,o.dispatchEventContext=o.dispatchContext=o.sendContext=o.triggerContext=o.emitContext=o.dispatchEventCall=o.dispatchCall=o.sendCall=o.triggerCall=o.emitCall;class i extends e{constructor({parent:t,GM_info:e,scriptSource:o,overrides:s}){if(super(),this.modInfo={},t&&(this.parent=t),o&&(this.modInfo.scriptSource=o),e){if("object"!=typeof e)throw new TypeError("Invalid GM_info!");if(!e)throw new TypeError("Invalid GM_info!");this.modInfo.GM_info=e,this.modInfo.scriptSource||(this.modInfo.scriptSource=e.scriptSource),this.modInfo.name||(this.modInfo.name=this.modInfo.GM_info.script.name),this.modInfo.version||(this.modInfo.version=this.modInfo.GM_info.script.version)}if(o)this.modInfo.header=i.parseScriptHeader(this.modInfo.scriptSource),this.modInfo.name=this.modInfo.header.name,this.modInfo.author=this.modInfo.header.author,this.modInfo.version=this.modInfo.header.version,this.modInfo.id=this.modInfo.header.UPI.id,this.modInfo.abbrev=this.modInfo.header.UPI.abbrev,this.modInfo.header.UPI.deps&&(this.modInfo.deps=this.modInfo.header.UPI.deps.split(/\s*,\s*/));else if(!s)throw"No Script Source!";if(s)for(let t in s)this.modInfo[t]=s[t];if(!this.modInfo.name)throw"No module name!";this.modInfo.id=this.modInfo.id||i.camelize(this.modInfo.name),this.modInfo.abbrev=this.modInfo.abbrev||this.modInfo.name.split(" ").map((t=>t[0].toUpperCase())).join(""),this.modInfo.depsLoaded=!this.modInfo.deps,this.parent?(this.parent[this.modInfo.id]=this,this.modInfo.idList=this.parent.abbrevList.concat([this.modInfo.id]),this.modInfo.abbrevList=this.parent.abbrevList.concat([this.modInfo.abbrev])):(this.modInfo.idList=[this.modInfo.id],this.modInfo.abbrevList=[this.modInfo.abbrev]),this.info(this.modInfo.name+(this.modInfo.author?" by "+this.modInfo.author:"")),this.parent&&this.parent.emit("submoduleLoaded",this)}static camelize(t){return t.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,(function(t,e){return 0==+t?"":0===e?t.toLowerCase():t.toUpperCase()}))}static parseScriptHeader(t){let e=t.match(/(?:\/\/\s*)?==UserScript==([\S\s]*)==\/UserScript==/)[1].split(/\n\s*\/\//g).map((t=>t.trim())).filter((t=>t)).map((t=>{let e=t.match(/\s+/);return[t.slice(0,e.index).split("."),t.slice(e.index+e[0].length)]}));mod.debug("header arrayForm:",e);let o={};for(let[t,i]of e){let e=t.pop(),s=o;for(let e of t){if(e in s&&"object"!=typeof s[e])throw`Path ${t.join(".")} has existing value at ${e}`;s=s[e]}if(e in s)throw`Value ${t.join(".")}.${key} already exists`;s[e]=i}return mod.debug("header objForm:",o)}}["debug","log","info","warn","error"].forEach((t=>i.prototype[t]=function(...e){return console[t](`[${this.modInfo.abbrevList.join(".")}]`,...e),e[0]})),UPI=new i({overrides:{name:"United Program Interface",author:"SArpnt and TumbleGamer",id:"UPI",abbrev:"UPI"}}),UPI.info(UPI)}();