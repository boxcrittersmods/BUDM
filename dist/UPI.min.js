const uWindow="undefined"!=typeof unsafeWindow?unsafeWindow:window;let UPI;!function(){"use strict";let e={uWindow:uWindow,UPI:UPI};if(window.UPI){for(let t in e)delete window[t];throw"UPI variables are global! please scope/sandbox it"}class t{constructor(e,t=!!e){if(!Array.isArray(e)&&void 0!==e)throw new TypeError("Paramater 1 must be type 'array'");if(this.strict=!!t,this.events={},this.Event=function(){this.ran=0,this.listeners=[]},e)for(let t of e)this.events[t]=new this.Event}on(e,t){if("function"!=typeof t)throw new TypeError(`Input 2 is type '${typeof t}' instead of 'function'`);if(!this.strict||this.events[e])return this.events[e]||(this.events[e]=new this.Event),this.events[e].listeners.push(t)-1;console.warn(`Event '${e}' does not exist`)}off(e,t){if(this.events[e]){if("function"==typeof t){let i=0;return this.events[e].listeners.forEach(((o,n)=>{o==t&&(i++,delete this.events[e].listeners[n])})),i}if("number"==typeof t){let i=this.events[e].listeners[t];return delete this.events[e].listeners[t],i}if(void 0===t)return this.events[e].listeners.splice(0,1/0);throw new TypeError(`Input 2 is type '${typeof a}' instead of 'function' or 'number'`)}this.strict&&console.warn(`Event '${e}' does not exist`)}emit(e,...t){return this.emitCall(e,this,...t)}emitCall(e,t,...i){if(!this.events[e]){if(this.strict)return console.warn(`Event '${e}' does not exist`),[];this.events[e]=new this.Event}let o=[];this.events[e].ran++;for(let n in this.events[e].listeners)try{o.push(this.events[e].listeners[n].apply(t,i))}catch(e){console.error(e),o.push(e)}return o}}let i=t.prototype;i.addEventListener=i.add=i.when=i.on,i.removeEventListener=i.remove=i.abort=i.off,i.dispatchEvent=i.dispatch=i.send=i.trigger=i.emit,i.dispatchEventContext=i.dispatchContext=i.sendContext=i.triggerContext=i.emitContext=i.dispatchEventCall=i.dispatchCall=i.sendCall=i.triggerCall=i.emitCall;class o extends t{constructor({parent:e,GM_info:t,scriptSource:i,overrides:n}){if(super(),this.modInfo={},this.parent&&(this.parent=e),this.modInfo.scriptSource=i,t){if("object"!=typeof t)throw new TypeError("Invalid GM_info!");if(!t)throw new TypeError("Invalid GM_info!");this.modInfo.GM_info=t,this.modInfo.scriptSource||(this.modInfo.scriptSource=t.scriptSource),this.modInfo.name||(this.modInfo.name=this.modInfo.GM_info.script.name),this.modInfo.version||(this.modInfo.version=this.modInfo.GM_info.script.name)}if(i)this.modInfo.header=o.parseScriptHeader(this.modInfo.scriptSource),this.modInfo.name=this.modInfo.header.name,this.modInfo.author=this.modInfo.header.author,this.modInfo.version=this.modInfo.header.version,this.modInfo.id=this.modInfo.header.UPI.id,this.modInfo.abbrev=this.modInfo.header.UPI.abbrev,this.modInfo.header.UPI.require&&(this.modInfo.require=this.modInfo.header.UPI.require.split(/\s*,\s*/));else if(!n)throw"No Script Source!";if(n)for(let e in n)this.modInfo[e]=n[e];if(!this.modInfo.name)throw"No module name!";this.modInfo.id=this.modInfo.id||o.camelize(this.modInfo.name),this.modInfo.abbrev=this.modInfo.abbrev||this.modInfo.name.split(" ").map((e=>e[0].toUpperCase())).join(""),this.parent?(this.parent[this.modInfo.id]=this,this.modInfo.idList=this.parent.abbrevList.concat([this.modInfo.id]),this.modInfo.abbrevList=this.parent.abbrevList.concat([this.modInfo.abbrev])):(this.modInfo.idList=[this.modInfo.id],this.modInfo.abbrevList=[this.modInfo.abbrev]),this.info(this.modInfo.name+(this.modInfo.author?" by "+this.modInfo.author:""))}static camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,(function(e,t){return 0==+e?"":0===t?e.toLowerCase():e.toUpperCase()}))}static parseScriptHeader(e){let t=e.match(/(?:\/\/\s*)?==UserScript==([\S\s]*)==\/UserScript==/)[1].split(/\n\s*\/\//g).map((e=>e.trim())).filter((e=>e)).map((e=>{let t=e.match(/\s+/);return[e.slice(0,t.index).split("."),e.slice(t.index+t[0].length)]}));mod.debug("header arrayForm:",t);let i={};for(let[e,o]of t){let t=e.pop(),n=i;for(let t of e){if(t in n&&"object"!=typeof n[t])throw`Path ${e.join(".")} has existing value at ${t}`;n=n[t]}if(t in n)throw`Value ${e.join(".")}.${key} already exists`;n[t]=o}return mod.debug("header objForm:",i)}}["debug","log","info","warn","error"].forEach((e=>o.prototype[e]=function(...t){return console[e](`[${this.modInfo.abbrevList.join(".")}]`,...t),t[0]})),UPI=new o({overrides:{name:"United Program Interface",author:"SArpnt and TumbleGamer",id:"UPI",abbrev:"UPI"}}),UPI.info(UPI)}();